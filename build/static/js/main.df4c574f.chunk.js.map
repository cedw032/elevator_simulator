{"version":3,"sources":["utils/dispatcher.js","constants/elevatorEvents.js","models/elevator.js","constants/elevatorState.js","constants/direction.js","models/usageSimulator.js","hooks/useForceUpdate.js","hooks/useAsyncState.js","components/TimeController.js","components/TestSettingsController.js","hooks/useForceUpdateOnEvents.js","components/FloorDisplay.js","components/ElevatorDisplay.js","components/AboutDisplay.js","App.js","index.js"],"names":["provideDispatcher","eventTypes","listeners","reduce","dispatcher","eventType","on","listener","push","filter","current","dispatch","_len","arguments","length","params","Array","_key","forEach","apply","ELEVATOR_EVENTS","provideElevator","floorCount","elevatorState","openTime","moveTime","currentFloor","currentDirection","destinations","requests","openTimeout","floors","i","canChangeDirection","filterFloorsAhead","floor","destinationsAhead","map","request","shouldOpen","destinationsAtCurrentFloor","requestsAtCurrentFloor","requestsAlsoMatchingCurrentDirection","destination","direction","isOpen","moveToNextFloor","allowDoorsToClose","_provideDispatcher","addDestination","destinationAdded","requestElevator","elevatorRequested","elapseTime","requestFilter","doorsOpen","openDoors","doorsClose","floorChange","timeElapsed","reset","setOpenTimeout","value","concat","isDestination","isRequested","provideUsageSimulator","elevator","unsubscribeTimeElapsed","enabled","spawn","randomInteger","min","max","Math","round","random","randomFloor","slice","origin","destinationEntered","cancelListeners","cancelResetListener","cancelDoorsOpenListener","elevatorDirection","toggle","undefined","useForceUpdate","_useState","useState","update","Object","slicedToArray","states","useAsyncState","initial","forceUpdate","id","state","AUTOPLAY_INTERVALS","TimeController","_ref","_useAsyncState","_useAsyncState2","asyncAutoplay","setAutoplay","_useAsyncState3","_useAsyncState4","asyncAutoplaySpeed","setAutoplaySpeed","useEffect","startAutoplay","changePlaySpeed","console","log","setTimeout","applyAutoplayTimestep","react_default","a","createElement","className","children","onClick","cx","TestSettingsController","usageSimulator","useForceUpdateOnEvents","subscribeMethods","unsubscribeMethods","subscribe","unsubscribe","FloorDisplay","disabled","ElevatorDisplay","key","AboutDisplay","App","components_TimeController","components_TestSettingsController","components_FloorDisplay","components_ElevatorDisplay","components_AboutDisplay","ReactDOM","render","src_App","document","getElementById"],"mappings":"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","file":"static/js/main.df4c574f.chunk.js","sourcesContent":["const provideDispatcher = eventTypes => {\n\n\tconst listeners = {};\n\n\treturn eventTypes.reduce((dispatcher, eventType) => {\n\t\tlisteners[eventType] = [];\n\n\t\tdispatcher.on[eventType] = listener => {\n\t\t\tlisteners[eventType].push(listener);\n\n\t\t\treturn () => {\n\t\t\t\tlisteners[eventType] = listeners[eventType].filter(\n\t\t\t\t\tcurrent => current !== listener\n\t\t\t\t);\n\t\t\t};\n\t\t};\n\n\t\tdispatcher.dispatch[eventType] = (...params) => {\n\t\t\tlisteners[eventType].forEach(listener => listener(...params));\n\t\t};\n\n\t\treturn dispatcher;\n\n\t}, {dispatch: {}, on: {}});\n\n}\n\nexport default provideDispatcher;","const ELEVATOR_EVENTS = [\n\t'doorsOpen',\n\t'doorsClose',\n\t'floorChange',\n\t'timeElapsed',\n\t'elevatorRequested',\n\t'destinationAdded',\n\t'reset',\n];\n\nexport default ELEVATOR_EVENTS;","import provideDispatcher from '../utils/dispatcher';\n\n//////////////// CONSTANTS\nimport {UP, DOWN} from '../constants/direction';\nimport {STOPPED, OPEN, MOVING} from '../constants/elevatorState';\nimport ELEVATOR_EVENTS from '../constants/elevatorEvents';\n//////////////// CONSTANTS // END\n\nconst provideElevator = (floorCount) => {\n\n\t//////////////// INTERNAL STATE\n\tlet elevatorState = STOPPED;\n\tlet openTime = 0;\n\tlet moveTime = 0;\n\tlet currentFloor = 1;\n\tlet currentDirection = UP;\n\tlet destinations = [];\n\tlet requests = [];\n\n\tlet openTimeout = 0;\n\tlet timestepsBetweenFloors = 0;\n\n\tconst floors = [];\n\tfor (let i = 1; i <= floorCount; ++i) floors.push(i);\n\t///////////////// INTERNAL STATE // END\n\n\t///////////////// INTERNAL DERIVED STATE\n\tconst hasFloorToMoveTo = () => {\n\t\treturn !!(destinations.length + requests.length);\n\t};\n\n\tconst canChangeDirection = () => {\n\n\t\tconst filterFloorsAhead = floor => floor * currentDirection > currentFloor * currentDirection;\n\n\t\tconst destinationsAhead = destinations.filter(filterFloorsAhead);\n\n\t\tconst requestFloorsAhead = requests.map(\n\t\t\trequest => request.floor\n\t\t).filter(filterFloorsAhead);\n\n\t\treturn !(requestFloorsAhead.length + destinationsAhead.length);\n\t};\n\n\tconst shouldOpen = () => {\n\t\t\n\t\tif (destinationsAtCurrentFloor().length) return true;\n\n\t\tif (requestsAtCurrentFloor().length) {\n\t\t\tif (canChangeDirection()) return true;\n\t\t\tif (requestsAlsoMatchingCurrentDirection().length) return true;\n\t\t}\n\n\t\treturn false;\n\n\t};\n\n\tconst destinationsAtCurrentFloor = () => destinations.filter(\n\t\tdestination => destination === currentFloor\n\t);\n\n\tconst requestsAtCurrentFloor = () => requests.filter(\n\t\trequest => request.floor === currentFloor\n\t);\n\n\tconst requestsAlsoMatchingCurrentDirection =  () => requestsAtCurrentFloor().filter(\n\t\trequest => request.direction === currentDirection\n\t);\n\n\tconst isOpen = () => elevatorState === OPEN;\n\n\t///////////////// INTERNAL DERIVED STATE // END\n\n\n\t///////////////// ACTIONS\n\tconst reset = () => {\n\t\televatorState = STOPPED;\n\t\topenTime = 0;\n\t\tmoveTime = 0;\n\t\tcurrentFloor = 1;\n\t\tcurrentDirection = UP;\n\t\tdestinations = [];\n\t\trequests = [];\n\t\tdispatch.reset();\n\t}\n\n\tconst addDestination = floor => {\n\t\tdestinations.push(floor);\n\t\tif (elevatorState === OPEN) allowDoorsToClose();\n\t\tdispatch.destinationAdded();\n\t};\n\n\tconst requestElevator = (floor, direction) => {\n\t\trequests.push({floor, direction});\n\t\tdispatch.elevatorRequested();\n\t}\n\n\tconst moveToNextFloor = () => {\n\t\tmoveTime = 0;\n\t\televatorState = MOVING;\n\t};\n\n\tconst closeDoors = () => {\n\t\televatorState = STOPPED;\n\t\tdispatch.doorsClose();\n\t};\n\n\tconst stopElevator = () => elevatorState = STOPPED;\n\n\tconst openDoors = () => {\n\t\topenTime = 0;\n\n\t\tdestinations = destinations.filter(\n\t\t\tdestination => destination !== currentFloor\n\t\t);\n\n\t\tconst requestFilter = canChangeDirection()\n\t\t\t? request => request.floor !== currentFloor\n\t\t\t: request => request.floor !== currentFloor || request.direction !== currentDirection;\n\n\t\trequests = requests.filter(requestFilter);\n\n\t\televatorState = OPEN;\n\t\tdispatch.doorsOpen(currentFloor, currentDirection, canChangeDirection());\n\t};\n\n\tconst updateCurrentFloor = () => {\n\t\tcurrentFloor += currentDirection;\n\t\tdispatch.floorChange();\n\t};\n\n\tconst updateCurrentDirection = () => {\n\t\tif (canChangeDirection()) {\n\t\t\tcurrentDirection *= DOWN;\n\t\t}\n\t};\n\n\tconst canDoorsClose = () => {\n\t\treturn openTime >= openTimeout;\n\t};\n\n\tconst allowDoorsToClose = () => {\n\t\tif (isOpen()) {\n\t\t\topenTime = openTimeout;\n\t\t}\n\t};\n\n\tconst elapseTime = () => {\n\t\tswitch (elevatorState) {\n\t\t\tcase STOPPED:\n\t\t\t\tif (shouldOpen()) {\n\t\t\t\t\topenDoors();\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tif (hasFloorToMoveTo()) {\n\t\t\t\t\tupdateCurrentDirection();\n\t\t\t\t\tmoveToNextFloor();\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tbreak;\n\n\t\t\tcase OPEN:\n\t\t\t\tif (canDoorsClose()) {\n\t\t\t\t\tcloseDoors();\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\t++openTime;\n\t\t\t\tbreak;\n\n\t\t\tcase MOVING:\n\t\t\t\tif (moveTime >= timestepsBetweenFloors) {\n\t\t\t\t\tupdateCurrentFloor();\n\n\t\t\t\t\tif (shouldOpen()) {\n\t\t\t\t\t\tstopElevator();\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\tmoveToNextFloor();\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\t++moveTime;\n\t\t\t\tbreak;\n\t\t}\n\n\t\tdispatch.timeElapsed();\n\t};\n\n\t///////////////// DISPATCHER\n\tconst {dispatch, on} = provideDispatcher(ELEVATOR_EVENTS);\n\t///////////////// DISPATCHER // END\n\n\t///////////////// PUBLIC INTERFACE\n\treturn {\n\t\taddDestination,\n\t\trequestElevator,\n\t\telapseTime,\n\t\tallowDoorsToClose,\n\t\treset,\n\n\t\tsetOpenTimeout: value => openTimeout = value,\n\n\t\tcurrentFloor: () => currentFloor,\n\t\tfloors: () => [...floors],\n\t\tisOpen,\n\n\t\tisDestination: floor => destinations.filter(\n\t\t\tdestination => destination === floor\n\t\t).length !== 0,\n\n\t\tisRequested: (floor, direction) => requests.filter(\n\t\t\trequest => request.floor === floor && request.direction === direction\n\t\t).length !== 0,\n\n\t\ton,\n\t};\n\t///////////////// PUBLIC INTERFACE // END\n\n}\n\nexport default provideElevator;","export const STOPPED = 0;\nexport const OPEN = 1;\nexport const MOVING = 2;","export const UP = 1;\nexport const DOWN = -1;","import {UP, DOWN} from '../constants/direction';\n\nconst provideUsageSimulator = elevator => {\n\n\tlet unsubscribeTimeElapsed;\n\tlet spawnChance = 0.16;\n\n\tconst enabled = () => {\n\t\treturn !!unsubscribeTimeElapsed;\n\t}\n\n\tconst toggle = () => {\n\n\t\tif (enabled()) {\n\t\t\tunsubscribeTimeElapsed();\n\t\t\tunsubscribeTimeElapsed = undefined;\n\t\t\treturn;\n\t\t}\n\n\t\tunsubscribeTimeElapsed = elevator.on.timeElapsed(elapseTime);\n\n\t};\n\n\tconst spawn = () => {\n\t\t\n\t\tconst randomInteger = (min, max) => \n\t\t\tMath.round((max - min) * Math.random()) + min;\n\n\t\tconst randomFloor = () => randomInteger(\n\t\t\televator.floors()[0], \n\t\t\t+elevator.floors().slice(-1)\n\t\t);\n\n\t\tconst entering = 1;\n\t\tconst exiting = -1;\n\n\t\tlet origin = 0;\n\t\tlet destination = 0;\n\n\t\tswitch (randomInteger(entering, exiting)) {\n\t\t\tcase entering:\n\t\t\t\torigin = elevator.floors()[0];\n\t\t\t\tdestination = randomFloor();\n\t\t\t\tbreak;\n\n\t\t\tcase exiting:\n\t\t\t\torigin = randomFloor();\n\t\t\t\tdestination = elevator.floors()[0];\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\torigin = randomFloor();\n\t\t\t\tdestination = randomFloor();\n\t\t\t\tbreak;\n\t\t}\n\n\t\tif (origin === destination) return;\n\n\t\tconst direction = origin < destination ? UP : DOWN;\n\n\t\tlet destinationEntered = false;\n\n\t\tconst cancelListeners = () => {\n\t\t\tcancelResetListener();\n\t\t\tcancelDoorsOpenListener();\n\t\t}\n\n\t\tconst cancelResetListener = elevator.on.reset(cancelListeners);\n\n\t\tconst cancelDoorsOpenListener = elevator.on.doorsOpen((floor, elevatorDirection, canChangeDirection) => {\n\t\t\tif (!destinationEntered && floor === origin) {\n\t\t\t\tif (canChangeDirection || elevatorDirection === direction) {\n\t\t\t\t\televator.addDestination(destination);\t\t\n\t\t\t\t\tdestinationEntered = true;\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (destinationEntered && floor === destination) {\n\t\t\t\televator.allowDoorsToClose();\n\t\t\t\tcancelListeners();\n\t\t\t}\n\t\t});\n\n\t\televator.requestElevator(origin, direction);\n\t\t\n\t}\n\n\tconst elapseTime = () => {\n\n\t\tif (Math.random() < spawnChance) {\n\t\t\tspawn();\n\t\t}\n\n\t};\n\n\treturn {\n\t\ttoggle,\n\t\tspawn,\n\t\tenabled,\n\t};\n\n}\n\nexport default provideUsageSimulator;","import {useState} from 'react';\n\nconst useForceUpdate = () => {\n\tconst [, update] = useState();\n\treturn () => update({});\n}\n\nexport default useForceUpdate;","import {useState} from 'react';\nimport useForceUpdate from './useForceUpdate';\n\nlet states = [];\n\nconst useAsyncState = (initial) => {\n\n\tconst forceUpdate = useForceUpdate();\n\tconst [id] = useState(states.length);\n\t\n\tlet state = states[id];\n\tif (!state) {\n\t\tstate = {value: initial};\n\t\tstates.push(state);\n\t}\n\n\tconst updateValue = (value) => {\n\t\t//if (value !== state.value) {\n\t\t\tstate.value = value;\n\t\t\tforceUpdate();\n\t\t//}\n\t};\n\n\treturn [state, updateValue];\n}\n\nexport default useAsyncState;","import React, {useEffect} from 'react';\nimport cx from 'classnames';\nimport useAsyncState from '../hooks/useAsyncState';\n\nconst AUTOPLAY_INTERVALS = [800, 140];\nconst AUTOPLAY_OPEN_TIMEOUT = 5;\n\nconst TimeController = ({elevator}) => {\n\n\tconst [asyncAutoplay, setAutoplay] = useAsyncState(true);\n\tconst [asyncAutoplaySpeed, setAutoplaySpeed] = useAsyncState(0);\n\n\tuseEffect(() => {\n\t\tif (asyncAutoplay.value) startAutoplay();\n\t}, []);\n\n\tconst applySingleTimestep = () => {\n\t\tsetAutoplay(false);\n\t\televator.elapseTime();\n\t}\n\n\tconst handleAutoplayButtonClick = () => {\n\t\tif (asyncAutoplay.value) {\n\t\t\tchangePlaySpeed();\n\t\t\treturn;\n\t\t}\n\n\t\tstartAutoplay();\n\t}\n\n\tconst changePlaySpeed = () => {\n\t\tsetAutoplaySpeed((asyncAutoplaySpeed.value + 1) % AUTOPLAY_INTERVALS.length);\n\t\tconsole.log('autoplay speed', asyncAutoplaySpeed.value);\n\t};\n\n\tconst startAutoplay = () => {\n\t\tsetAutoplay(true);\n\t\televator.setOpenTimeout(AUTOPLAY_OPEN_TIMEOUT);\n\t\tsetTimeout(applyAutoplayTimestep);\n\t}\n\n\tconst applyAutoplayTimestep = () => {\n\t\tif (asyncAutoplay.value) {\n\t\t\televator.elapseTime();\n\t\t\tsetTimeout(\n\t\t\t\tapplyAutoplayTimestep, \n\t\t\t\tAUTOPLAY_INTERVALS[asyncAutoplaySpeed.value]\n\t\t\t);\n\t\t\treturn;\n\t\t}\n\n\t\televator.setOpenTimeout(0);\n\t}\n\n\treturn (\n\t\t<div className='row'>\n\t\t\t<button \n\t\t\t\tchildren='|>'\n\t\t\t\tonClick={applySingleTimestep}/>\n\n\t\t\t<button \n\t\t\t\tchildren={asyncAutoplaySpeed.value ? '>>' : '>'}\n\t\t\t\tclassName={cx(asyncAutoplay.value && 'toggled')}\n\t\t\t\tonClick={handleAutoplayButtonClick}/>\n\t\t</div>\n\t);\n};\n\nexport default TimeController;","import React from 'react';\nimport cx from 'classnames';\nimport useForceUpdate from '../hooks/useForceUpdate';\n\n\nconst TestSettingsController = ({usageSimulator, elevator}) => {\n\n\tconst forceUpdate = useForceUpdate();\n\n\treturn (\n\t\t<div className='row'>\n\t\t\t<button \n\t\t\t\tonClick={() => {\n\t\t\t\t\tusageSimulator.spawn();\n\t\t\t\t}}\n\t\t\t\tchildren='Random passenger'/>\n\t\t\t<button \n\t\t\t\tclassName={cx(usageSimulator.enabled() && 'toggled')}\n\t\t\t\tonClick={() => {\n\t\t\t\t\tusageSimulator.toggle();\n\t\t\t\t\tforceUpdate();\n\t\t\t\t}}\n\t\t\t\tchildren='Simulate usage'/>\n\n\t\t\t<button \n\t\t\t\tonClick={() => {\n\t\t\t\t\televator.reset();\n\t\t\t\t}}\n\t\t\t\tchildren='x'/>\n\t\t</div>\n\t);\n};\n\nexport default TestSettingsController;","import {useEffect} from 'react';\nimport useForceUpdate from './useForceUpdate';\n\nconst useForceUpdateOnEvents = (subscribeMethods) => {\n\tconst forceUpdate = useForceUpdate();\n\tuseEffect(() => {\n\t\tconst unsubscribeMethods = [];\n\t\tsubscribeMethods.forEach(\n\t\t\tsubscribe => unsubscribeMethods.push(subscribe(forceUpdate))\n\t\t);\n\n\t\treturn () => unsubscribeMethods.forEach(unsubscribe => unsubscribe());\n\t}, []);\n}\n\nexport default useForceUpdateOnEvents;","import React from 'react';\nimport cx from 'classnames';\nimport {DOWN, UP} from '../constants/direction';\nimport useForceUpdateOnEvents from '../hooks/useForceUpdateOnEvents';\n\nconst FloorDisplay = ({floor, elevator}) => {\n\n\tuseForceUpdateOnEvents([\n\t\televator.on.floorChange,\n\t\televator.on.doorsOpen,\n\t\televator.on.doorsClose,\n\t\televator.on.elevatorRequested,\n\t\televator.on.reset,\n\t]);\n\n\tconst isDoorOpen = () => elevator.currentFloor() === floor && elevator.isOpen()\n\n\tconst isAtThisFloor = () => elevator.currentFloor() === floor;\n\n\tconst thisIsTopFloor = () => floor === +elevator.floors().slice(-1);\n\n\tconst thisIsBottomFloor = () => floor === elevator.floors()[0];\n\n\tconst isRequested = direction => elevator.isRequested(floor, direction)\n\n\tconst requestElevator = direction => () => elevator.requestElevator(floor, direction);\n\n\treturn (\n\t\t<div className={cx('row', 'floor-display', isAtThisFloor() && 'highlight')}>\n\t\t\t<div>\n\t\t\t\tFloor {floor}\n\t\t\t</div>\n\t\t\t\n\t\t\t<button \n\t\t\t\tclassName={cx(isRequested(DOWN) && 'toggled')}\n\t\t\t\tonClick={requestElevator(DOWN)}\n\t\t\t\tdisabled={thisIsBottomFloor()}\n\t\t\t\tchildren='Down'/>\n\t\t\t\n\t\t\t<button \n\t\t\t\tclassName={cx(isRequested(UP) && 'toggled')}\n\t\t\t\tonClick={requestElevator(UP)}\n\t\t\t\tdisabled={thisIsTopFloor()}\n\t\t\t\tchildren='Up'/>\n\t\t\t\n\t\t\t{isDoorOpen()\n\t\t\t\t? <div className='highlight2'>Open</div>\n\t\t\t\t: <div className='hidden'>Open</div>\n\t\t\t}\n\t\t</div>\n\t);\n};\n\nexport default FloorDisplay;","import React from 'react';\nimport cx from 'classnames';\nimport useForceUpdateOnEvents from '../hooks/useForceUpdateOnEvents';\n\nconst ElevatorDisplay = ({elevator}) => {\n\n\tuseForceUpdateOnEvents([\n\t\televator.on.doorsOpen,\n\t\televator.on.destinationAdded,\n\t\televator.on.reset,\n\t]);\n\n\treturn (\n\t\t<div className='elevator-display'>\n\t\t\t{elevator.floors().map((floor) =>\n\t\t\t\t<button\n\t\t\t\t\tchildren={floor}\n\t\t\t\t\tkey={floor}\n\t\t\t\t\tclassName={\n\t\t\t\t\t\tcx(elevator.isDestination(floor) && 'toggled')\n\t\t\t\t\t}\n\t\t\t\t\tonClick={() => elevator.addDestination(floor)}/>\n\t\t\t)}\n\t\t</div>\n\t);\n};\n\nexport default ElevatorDisplay;","import React from 'react';\n\nconst AboutDisplay = () => {\n\treturn (\n\t\t<div className='panel'>\n\t\t\tA bried exlanation of the UI.\n\n\t\t\t<h3>Top bar</h3>\n\t\t\t<p>From left to right</p>\n\t\t\t<p>\n\t\t\t\t<b>Step by step mode: </b> Clicking this button will enter step by step mode.\n\t\t\t\tThis means the elevator will only run one cycle of its state machine with each \n\t\t\t\tclick on this button.  This can be useful for watching what the elevator does \n\t\t\t\tunder certain situations.\n\t\t\t</p>\n\n\t\t\t<p>\n\t\t\t\t<b>Play/Fast Forward: </b> This button will exit step by step mode, and subsequent \n\t\t\t\tclicks will cycle between fast and regular play speeds.\n\t\t\t</p>\n\n\t\t\t<p>\n\t\t\t\t<b>Random Passenger: </b> When you want to add a passenger to the simulation pushing \n\t\t\t\tthis button will do so.\n\t\t\t</p>\n\n\t\t\t<p>\n\t\t\t\t<b>Simulate usage: </b> This will periodically add random passengers to the simulation\n\t\t\t\tat random intervals.  Handy for seeing how the elevator will behave under normal circumstances.\n\t\t\t\tClicking again will disable this feature.\n\t\t\t</p>\n\n\t\t\t<p>\n\t\t\t\t<b>Reset: </b> If you want to put the elevator back into its initial state click this button.\n\t\t\t\tThis is useful when you want to run specific test.  This button will not reset the play settings\n\t\t\t\tso you may want to make sure you enter step by step mode, and disabled usage simulation before\n\t\t\t\tresetting.\n\t\t\t</p>\n\n\t\t\t<h3>Left section</h3>\n\t\t\t<p>\n\t\t\t\tThis section is broken up into floors.\n\t\t\t\tPressing any up or down button will summon the elevator to that floor.\n\t\t\t\tWhen a floor is highlighted it means the elevator is at the floor.\n\t\t\t\tYou will also see the word open when the elevator doors are open on that floor.\n\t\t\t</p>\n\n\t\t\t<h3>Right section</h3>\n\t\t\t<p>\n\t\t\t\tThis represents the options available to a passenger inside the elevator.\n\t\t\t\tPressing any of the numbered buttons will inform the elevator that you want\n\t\t\t\tto travel to that level.\n\t\t\t</p>\n\t\t</div>\n\t);\n}\n\nexport default AboutDisplay;","import React from 'react';\nimport './App.css';\n\nimport provideElevator from './models/elevator';\nimport provideUsageSimulator from './models/usageSimulator';\n\nimport TimeController from './components/TimeController'\nimport TestSettingsController from './components/TestSettingsController'\nimport FloorDisplay from './components/FloorDisplay';\nimport ElevatorDisplay from './components/ElevatorDisplay';\nimport AboutDisplay from './components/AboutDisplay';\n\nconst FLOOR_COUNT = 10;\n\nconst elevator = provideElevator(FLOOR_COUNT);\nconst usageSimulator = provideUsageSimulator(elevator);\n\nfunction App() {\n\n\treturn (\n\t\t<div className='app'>\n\t\t\t\n\t\t\t<div className='panel row top-bar'>\n\t\t\t\t<TimeController elevator={elevator}/>\n\t\t\t\t<TestSettingsController \n\t\t\t\t\tusageSimulator={usageSimulator}\n\t\t\t\t\televator={elevator}/>\n\t\t\t</div>\n\n\t\t\t<div className='row'>\n\t\t\t\t<div className='floor-bank panel'>\n\t\t\t\t\t{elevator.floors().map(floor =>\n\t\t\t\t\t\t<FloorDisplay \n\t\t\t\t\t\t\tfloor={floor}\n\t\t\t\t\t\t\televator={elevator}\n\t\t\t\t\t\t\tkey={floor}/>\n\t\t\t\t\t)}\n\t\t\t\t</div>\n\t\t\t\t<ElevatorDisplay elevator={elevator}/>\n\t\t\t</div>\n\t\t\t<AboutDisplay/>\n\t\t</div>\n\t);\n}\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\n\nReactDOM.render(<App />, document.getElementById('root'));\n"],"sourceRoot":""}